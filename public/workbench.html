<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Operations Workbench - Spreadsheet Simplicity</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Third-party libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <!-- Link to the new stylesheet -->
    <link rel="stylesheet" href="/css/workbench.css">
</head>
<body class="flex flex-col h-screen bg-slate-50 text-slate-800 font-sans">

    <header class="bg-white border-b border-slate-200 flex-shrink-0">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="/" class="flex items-center space-x-3">
                <span class="text-xl font-bold text-slate-900">Spreadsheet Simplicity</span>
            </a>
            <nav class="flex items-center space-x-8">
                <a href="/" class="text-slate-600 hover:text-blue-600 font-medium transition-colors">Home</a>
                <a href="/workbench.html" class="text-blue-600 font-bold">The Workbench</a>
            </nav>
        </div>
    </header>

    <main class="flex-grow flex overflow-hidden">
        <!-- Sidebar for Actions -->
        <aside id="sidebar" class="w-80 bg-white p-4 border-r border-slate-200 flex flex-col flex-shrink-0 overflow-y-auto">
            <div id="file-manager" class="mb-4">
                <h3 class="font-semibold text-slate-500 mb-2 text-xs uppercase tracking-wider px-2">1. Load Data</h3>
                <label for="file-upload" class="w-full text-center bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 cursor-pointer block transition-colors">
                    Upload File(s)
                </label>
                <input type="file" id="file-upload" accept=".xlsx, .xls, .csv" multiple class="hidden">
                <div id="loaded-files-list" class="mt-3 text-sm space-y-1"></div>
            </div>
            
            <div id="actions-container" class="hidden">
                <h3 class="font-semibold text-slate-500 mb-2 border-t border-slate-200 pt-4 text-xs uppercase tracking-wider px-2">2. Choose Action</h3>
                
                <!-- Data Quality Hub -->
                <div class="action-group mb-2">
                    <div class="px-2 mb-2">
                         <h4 class="font-semibold text-slate-800">Data Quality Hub</h4>
                         <p class="text-xs text-slate-500 mt-1">Define rules and validate your active dataset for errors.</p>
                    </div>
                    <div class="action-list px-0">
                         <button id="validator-run-btn" class="action-btn !justify-center !text-base !font-bold !bg-green-600 !text-white hover:!bg-green-700">Validate Active Sheet</button>
                         <button id="validator-manage-dict-btn" class="action-btn">
                              <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                              Manage Dictionary
                         </button>
                         <button id="validator-manage-cat-btn" class="action-btn">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M2.5 3A1.5 1.5 0 001 4.5v11A1.5 1.5 0 002.5 17h15a1.5 1.5 0 001.5-1.5v-11A1.5 1.5 0 0017.5 3h-15zm4.512 4.012a.75.75 0 01.75-.75h5.476a.75.75 0 01.529 1.28L9.81 11.25H14.5a.75.75 0 010 1.5h-5a.75.75 0 01-.529-.22L5.262 8.53a.75.75 0 01-.004-1.038l1.754-1.48z" clip-rule="evenodd" /></svg>
                            Manage Categories
                         </button>
                    </div>
                </div>

                <!-- Standard Action Groups -->
                <details class="action-group" open>
                    <summary>Clean & Transform</summary>
                    <div class="action-list">
                        <button id="action-trim-whitespace" class="action-btn"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M6.12 3.22a.75.75 0 010 1.06L3.94 6.5h12.12a.75.75 0 010 1.5H3.94l2.18 2.22a.75.75 0 11-1.06 1.06l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5a.75.75 0 011.06 0zm7.76 13.56a.75.75 0 01-1.06 0l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5a.75.75 0 111.06 1.06L11.88 12h2.18a.75.75 0 010 1.5h-2.18l2.22 2.22a.75.75 0 010 1.06z"></path></svg>Trim Whitespace</button>
                        <button id="action-anonymize" class="action-btn"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2zM10 15a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 15zM10 7a3 3 0 100 6 3 3 0 000-6zM4.33 6.045a.75.75 0 01.03 1.06l-1.5 1.5a.75.75 0 01-1.06-1.06l1.5-1.5a.75.75 0 011.03-.03zm12.38-1.06a.75.75 0 011.06 0l1.5 1.5a.75.75 0 11-1.06 1.06l-1.5-1.5a.75.75 0 010-1.06zM17.715 14.33a.75.75 0 01-1.06-.03l-1.5-1.5a.75.75 0 011.06-1.06l1.5 1.5c.3.29.3.77-.03 1.06zM2.285 14.33a.75.75 0 01-.03-1.06l1.5-1.5a.75.75 0 011.06 1.06l-1.5 1.5a.75.75 0 01-1.03.03z"></path></svg>Anonymize PII</button>
                        <button id="action-extract-columns" class="action-btn"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M2 3.5A1.5 1.5 0 013.5 2h2.75a.75.75 0 010 1.5H3.5a.5.5 0 00-.5.5v12.5a.5.5 0 00.5.5h2.75a.75.75 0 010 1.5H3.5A1.5 1.5 0 012 16.5v-13z" clip-rule="evenodd"></path><path d="M13 2.75a.75.75 0 00-1.5 0V16a.75.75 0 001.5 0V2.75z"></path><path fill-rule="evenodd" d="M16.5 2a1.5 1.5 0 011.5 1.5v13a1.5 1.5 0 01-1.5 1.5h-2.75a.75.75 0 010-1.5h2.75a.5.5 0 00.5-.5V3.5a.5.5 0 00-.5-.5h-2.75a.75.75 0 010-1.5h2.75z" clip-rule="evenodd"></path></svg>Extract Columns</button>
                    </div>
                </details>
                <details class="action-group">
                    <summary>Combine & Merge</summary>
                     <div class="action-list">
                        <button id="action-stack-sheets" class="action-btn"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M3.5 4.5a.5.5 0 00-1 0V15a.5.5 0 00.5.5h12.5a.5.5 0 000-1H3V4.5z"></path><path d="M6 6.5A.5.5 0 016.5 6h11a.5.5 0 01.5.5v11a.5.5 0 01-.5.5h-11a.5.5 0 01-.5-.5v-11zM7 7v10h10V7H7z"></path></svg>Stack All Sheets</button>
                        <button id="action-merge-files" class="action-btn"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.5 5.25a.75.75 0 01.75-.75h2.5a.75.75 0 01.75.75v2.5a.75.75 0 01-1.5 0V6.56l-3.22 3.22a.75.75 0 11-1.06-1.06l3.22-3.22H13.25a.75.75 0 01-.75-.75z" clip-rule="evenodd"></path><path fill-rule="evenodd" d="M5.636 14.364a.75.75 0 010-1.06l4.243-4.243a.75.75 0 011.06 1.06l-4.243 4.243a.75.75 0 01-1.06 0zm-1.06-1.06a.75.75 0 01-1.06 0l-2.25-2.25a.75.75 0 010-1.061l2.25-2.25a.75.75 0 011.06 1.06L3.81 9.25l1.724 1.724a.75.75 0 010 1.06z" clip-rule="evenodd"></path></svg>Merge Files (Join)</button>
                    </div>
                </details>
                <details class="action-group">
                    <summary>Analyze & Compare</summary>
                     <div class="action-list">
                        <button id="action-find-duplicates" class="action-btn"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M7 3.5A1.5 1.5 0 018.5 2h5.5a1.5 1.5 0 011.5 1.5v1a.5.5 0 001 0v-1A2.5 2.5 0 0014 1h-5.5A2.5 2.5 0 006 3.5v11A2.5 2.5 0 008.5 17h5.5a2.5 2.5 0 002.5-2.5v-1a.5.5 0 00-1 0v1a1.5 1.5 0 01-1.5 1.5h-5.5A1.5 1.5 0 017 14.5v-11z"></path><path d="M4.5 5A1.5 1.5 0 003 6.5v9A1.5 1.5 0 004.5 17h5a1.5 1.5 0 001.5-1.5v-9A1.5 1.5 0 009.5 5h-5z"></path></svg>Find Duplicates</button>
                        <button id="action-compare-sheets" class="action-btn"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2a.75.75 0 01.75.75v12.59l3.22-3.22a.75.75 0 111.06 1.06l-4.5 4.5a.75.75 0 01-1.06 0l-4.5-4.5a.75.75 0 111.06-1.06l3.22 3.22V2.75A.75.75 0 0110 2z" clip-rule="evenodd"></path></svg>Compare Sheets</button>
                    </div>
                </details>
                 <details class="action-group">
                    <summary>Restructure</summary>
                     <div class="action-list">
                        <button id="action-split-file" class="action-btn"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"></path><path fill-rule="evenodd" d="M1.5 10a8.5 8.5 0 1117 0 8.5 8.5 0 01-17 0zM10 2.5a7.5 7.5 0 100 15 7.5 7.5 0 000-15z" clip-rule="evenodd"></path></svg>Split File by Rows</button>
                    </div>
                </details>
            </div>
        </aside>

        <!-- Main Content Area -->
        <section class="flex-grow flex flex-col p-6 overflow-hidden">
            <!-- Welcome View -->
            <div id="welcome-view" class="flex-grow flex items-center justify-center text-center">
                <div class="p-8">
                    <h1 class="text-4xl font-bold text-slate-800">Data Operations Workbench</h1>
                    <p class="text-lg text-slate-600 mt-2">Upload an Excel or CSV file using the sidebar to begin.</p>
                </div>
            </div>

            <!-- Data Table View -->
            <div id="data-view" class="hidden flex-grow flex flex-col overflow-hidden">
                <div class="flex justify-between items-center mb-4 flex-shrink-0">
                    <h2 id="table-title" class="text-2xl font-bold text-slate-900 truncate"></h2>
                    <button id="download-btn" class="btn-primary">Download Active Sheet</button>
                </div>
                <div id="data-table-container" class="flex-grow rounded-lg overflow-auto bg-white shadow-sm border border-slate-200">
                    <!-- Standard data table will be rendered here -->
                </div>
                <div id="status-bar" class="text-sm text-slate-600 mt-2 flex-shrink-0 p-1"></div>
            </div>
            
            <!-- Validation Results View -->
            <section id="validation-results-view" class="hidden flex-grow flex flex-col overflow-hidden"></section>
        </section>
    </main>

    <!-- Generic Modal for Configurations -->
    <div id="config-modal" class="hidden full-screen-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title" class="text-xl font-bold">Configuration</h2>
                <button data-action="close-modal" data-target="config-modal" class="modal-close-btn">&times;</button>
            </div>
            <div id="modal-body" class="modal-body"></div>
            <div class="modal-footer">
                <button data-action="close-modal" data-target="config-modal" class="btn-secondary">Cancel</button>
                <button id="modal-confirm-btn" class="btn-primary">Confirm</button>
            </div>
        </div>
    </div>
    
    <!-- Validator: Dictionary Editor Modal -->
    <div id="dictionaryModal" class="full-screen-overlay hidden">
        <div class="modal-content !max-w-7xl">
            <div class="modal-header">
                <h3 class="text-2xl font-bold text-gray-800">Define Data Dictionary Rules</h3>
                <button data-action="close-modal" data-target="dictionaryModal" class="modal-close-btn">×</button>
            </div>
            <div class="modal-body">
                <div class="mb-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="builder_dictionaryName" class="label">Data Dictionary Name</label>
                        <input type="text" id="builder_dictionaryName" class="input">
                    </div>
                    <div>
                        <label for="restore-input" class="label">Restore from Backup</label>
                        <input type="file" id="restore-input" accept=".json" class="input-file">
                    </div>
                </div>
                <div id="rulesTableContainer"><table id="rulesTable" class="w-full text-sm"><thead><tr><th>Column</th><th>Rule Category</th><th>Description</th><th>Defined Rules</th><th>Add New Rule</th></tr></thead><tbody></tbody></table></div>
            </div>
            <div class="modal-footer">
                <button data-action="download-pdf-dictionary" class="btn-secondary">Download PDF</button>
                <button id="builder_saveAndCloseBtn" class="btn-primary">Save and Close</button>
            </div>
        </div>
    </div>

    <!-- Validator: Category Editor Modal -->
    <div id="ruleCategoryModal" class="full-screen-overlay hidden">
        <div class="modal-content !max-w-4xl">
             <div class="modal-header">
                <h3 class="text-2xl font-bold text-gray-800">Manage Rule Categories</h3>
                <button id="categoryEditorCloseBtn" class="modal-close-btn">×</button>
            </div>
            <div class="modal-body">
                <div class="flex gap-6 flex-grow min-h-0">
                    <div class="w-1/3 flex flex-col border rounded-lg"><div class="p-2 border-b"><button data-action="add-new-category" class="w-full btn-primary text-sm !py-2">+ Add New Category</button></div><div id="ruleCategoryList" class="flex-grow overflow-y-auto"></div></div>
                    <div id="ruleCategoryEditorContainer" class="w-2/3 p-4 bg-slate-50 rounded-lg hidden">
                        <h4 class="text-xl font-bold mb-4" id="categoryEditorTitle"></h4>
                        <div class="mb-4"><h5 class="font-semibold mb-2">Defined Rules</h5><div id="categoryRulesDisplay" class="flex flex-wrap gap-2 p-2 min-h-[40px] border rounded-md bg-white"></div></div>
                        <div><h5 class="font-semibold mb-2">Add New Rule</h5><div class="flex gap-2 items-center"><select id="categoryRuleType" class="input !p-1 w-1/3"><option value="REQUIRED">REQUIRED</option> <option value="NOT REQUIRED">NOT REQUIRED</option> <option value="ALLOWED_VALUES">ALLOWED_VALUES</option> <option value="REGEX">REGEX</option> <option value="VALID_DATE">VALID_DATE</option> <option value="NO_FUTURE_DATE">NO_FUTURE_DATE</option></select><input id="categoryRuleValue" type="text" placeholder="Value (if needed)..." class="input !p-1 w-1/3"><button data-action="add-rule-to-category" class="btn-primary text-sm !px-3 !py-1">+</button></div></div>
                        <div class="mt-auto pt-4 text-right"><button data-action="delete-category" class="btn-danger">Delete Category</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="loader-overlay" class="hidden fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50">
        <div class="loader"></div>
    </div>
    
    <script src="/js/workbench.js"></script>
</body>
</html>
