<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Claim Status Report Tool - Spreadsheet Simplicity</title>
<script src="https://cdn.tailwindcss.com"></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- FIXED: Correct path for deployed site -->
<link rel="stylesheet" href="/css/claim-status-report.css">
</head>
<body>

<header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
         <a href="/" class="flex items-center space-x-2">
            <span class="text-2xl font-bold text-gray-900">Spreadsheet Simplicity</span>
        </a>
        <nav id="main-nav" class="hidden md:flex items-center space-x-8">
            <a href="/ClaimStatusReportTool.html" class="text-indigo-600 font-bold">Claim Status Report Tool</a>
        </nav>
    </div>
</header>

<main id="tool-content" class="container mx-auto px-6 py-12">
    <div class="max-w-4xl mx-auto">
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900">Unified Claim Status Report Tool</h1>
            <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-600">
                Select a client, upload today's **raw report**, and yesterday's **generated "Overall Daily Action Report"** for comparison.
            </p>
        </div>
        <div class="bg-white rounded-xl shadow-lg p-8 space-y-8">

            <div>
                <h2 class="text-2xl font-bold text-gray-900 mb-4">1. Select Client</h2>
                <select id="client-select" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">-- Choose a Client --</option>
                    <option value="solis">SOLIS</option>
                    <option value="liberty">LIBERTY</option>
                    <option value="secur">SECUR (Sonder)</option>
                    <option value="csh">CSH</option>
                </select>
            </div>

            <div id="configuration-container" class="hidden">
                <h2 class="text-2xl font-bold text-gray-900 mb-4 border-t pt-8">2. Configuration for Today's RAW Report</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div><label id="cleanAgeCol-label" for="cleanAgeCol">Clean Age:</label><input type="text" id="cleanAgeCol" class="mt-1 w-full p-2 border rounded-md uppercase"></div>
                    <div><label for="claimStatusCol">Claim State:</label><input type="text" id="claimStatusCol" class="mt-1 w-full p-2 border rounded-md uppercase"></div>
                    <div><label for="claimNumberCol">Claim Number:</label><input type="text" id="claimNumberCol" class="mt-1 w-full p-2 border rounded-md uppercase"></div>
                    <div><label for="payerCol">Payer:</label><input type="text" id="payerCol" class="mt-1 w-full p-2 border rounded-md uppercase"></div>
                    <div><label for="networkStatusCol">Network Status (Par/Non-Par):</label><input type="text" id="networkStatusCol" class="mt-1 w-full p-2 border rounded-md uppercase"></div>
                    <div><label for="dsnpCol">DSNP Status:</label><input type="text" id="dsnpCol" class="mt-1 w-full p-2 border rounded-md uppercase"></div>
                    <div><label for="claimTypeCol">Claim Type:</label><input type="text" id="claimTypeCol" class="mt-1 w-full p-2 border rounded-md uppercase"></div>
                    <div><label for="totalChargesCol">Total Charges:</label><input type="text" id="totalChargesCol" class="mt-1 w-full p-2 border rounded-md uppercase"></div>
                    <div><label for="notesCol">W9/Notes Column:</label><input type="text" id="notesCol" class="mt-1 w-full p-2 border rounded-md uppercase"></div>
                    <div class="md:col-span-3"><label for="dateCols">Date Columns:</label><input type="text" id="dateCols" class="mt-1 w-full p-2 border rounded-md uppercase"></div>
                </div>
            </div>

            <div id="upload-container" class="hidden">
                <div class="border-t pt-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4">3. Upload Reports</h2>
                    <div class="space-y-6">
                        <div>
                            <label for="fileInput" class="block text-lg font-semibold text-gray-800 mb-2">Today's RAW Report (Required):</label>
                            <input type="file" id="fileInput" accept=".xlsx, .xls, .csv" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                            <div id="fileName" class="text-left mt-2 text-sm text-gray-600">No file selected</div>
                        </div>
                        <div>
                            <label for="yesterdayFileInput" class="block text-lg font-semibold text-gray-800 mb-2">Yesterday's GENERATED Report (Optional):</label>
                            <input type="file" id="yesterdayFileInput" accept=".xlsx, .xls, .csv" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                            <div id="yesterdayFileName" class="text-left mt-2 text-sm text-gray-600">No file selected. Please use the "Overall Daily Action Report" generated by this tool.</div>
                        </div>
                    </div>
                    <div class="text-center mt-8">
                        <button id="processBtn" disabled class="bg-indigo-600 text-white font-bold text-lg rounded-lg py-3 px-10 hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed">Process Reports</button>
                    </div>
                </div>
            </div>

            <div id="status" class="text-center mt-4 font-semibold h-6"></div>
            <div id="loader"></div>

            <div id="warning-container" class="hidden mt-6 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded-md" role="alert">
              <p class="font-bold">Configuration Alert</p>
              <p id="warning-message"></p>
            </div>

            <div id="review-container" class="hidden space-y-8 border-t pt-8">
                <div class="text-center">
                    <h2 class="text-3xl font-extrabold text-gray-900">4. Review & Finalize</h2>
                    <p class="mt-2 text-lg text-gray-600">Follow the steps below to assign claims and generate your final reports.</p>
                </div>

                <div id="movement-summary-container" class="hidden bg-blue-50 p-6 rounded-lg">
                    <h3 class="text-xl font-bold text-gray-900 mb-3">Workflow & Aging Movement Summary</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
                        <p>Claims moved from PV to Claims: <strong id="pv-to-claims-count" class="text-blue-800">0</strong></p>
                        <p>Claims moved from Claims to PV: <strong id="claims-to-pv-count" class="text-blue-800">0</strong></p>
                        <p>Critical claims moved to Backlog: <strong id="critical-to-backlog-count" class="text-red-600">0</strong></p>
                        <p>Critical claims worked/removed: <strong id="critical-worked-count" class="text-green-600">0</strong></p>
                        <p class="md:col-span-2 text-yellow-900 font-semibold bg-yellow-200 -m-2 p-2 rounded">Claims moving to Critical (28-30 Days) tomorrow: <strong id="moving-to-critical-count" class="text-yellow-900">0</strong></p>
                    </div>
                </div>

                <div id="approaching-critical-container" class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-6 rounded-lg">
                    <h3 class="text-xl font-bold text-gray-900 mb-3">Claims Approaching Critical Status (27 Days Old)</h3>
                    <p class="text-gray-700 mb-4">These claims will move into the CRITICAL (28-29 day) bucket tomorrow. Prioritize them to prevent aging.</p>
                    <div id="approaching-critical-table-container"></div>
                </div>

                <div id="prebatch-container" class="hidden bg-gray-50 p-6 rounded-lg">
                    <h3 class="text-xl font-bold text-gray-900 mb-3">Prebatch Claims</h3>
                    <p id="prebatch-summary" class="text-gray-700 mb-4"></p>
                    <button id="downloadPrebatchBtn" class="bg-teal-600 text-white font-bold text-lg rounded-lg py-3 px-8 hover:bg-teal-700">Download Prebatch Report</button>
                </div>

                <div class="bg-gray-50 p-6 rounded-lg space-y-6 border border-gray-200">
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Assignment Workflow</h3>

                    <div id="assignment-download-step">
                        <p class="block text-lg font-semibold text-gray-800 mb-1">Step A: Download Assignment Report</p>
                        <p class="text-gray-600 mb-3">This file contains a unique list of all claim states and notes. Fill in the final column to assign ownership.</p>
                        <button id="downloadAssignmentReportBtn" class="bg-blue-600 text-white font-bold text-lg rounded-lg py-3 px-8 hover:bg-blue-700">Download Assignment Report</button>
                    </div>

                    <div id="assignment-upload-step" class="hidden border-t pt-6">
                        <label for="assignmentFileInput" class="block text-lg font-semibold text-gray-800 mb-1">Step B: Upload Completed Assignment Report</label>
                        <p class="text-gray-600 mb-3">Once uploaded and validated, you can generate the final action reports below.</p>
                        <input type="file" id="assignmentFileInput" accept=".xlsx, .xls, .csv" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                        <div id="assignmentFileName" class="text-left mt-2 text-sm text-gray-600">No file selected.</div>
                    </div>
                </div>

                <div class="text-center pt-6">
                    <button id="generateFinalReportsBtn" disabled class="bg-green-600 text-white font-bold text-lg rounded-lg py-3 px-10 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed">Generate Final Reports</button>
                </div>
            </div>

            <div id="final-downloads-container" class="hidden text-center mt-4 space-y-4">
                <div id="download-links-container" class="flex flex-wrap justify-center gap-4"></div>
                <button id="copyEmailBtn" class="hidden inline-block bg-blue-600 text-white font-bold text-lg rounded-lg py-3 px-10 hover:bg-blue-700">Copy Email Text</button>
            </div>
        </div>
    </div>
</main>

<div id="chart-render-container" class="chart-container"></div>
<!-- FIXED: Correct path for deployed site -->
<script type="module" src="/js/claim-status-tool/main.js"></script>
</body>
</html>
